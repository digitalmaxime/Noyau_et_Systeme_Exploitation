#include <semaphore.h>
#include <pthread.h>
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <assert.h>

struct argumentThread {
    int compteur;
    int tid;
    sem_t* sem;
};

void* acces_bd(int id_boucle, int tid){
    return NULL ;
}

void* wrapper (void* _args) {
    struct argumentThread* args = (struct argumentThread*) _args;
    args->tid = pthread_self();
    //controle acces a la BD
    sem_wait(args->sem);
    acces_bd(args->compteur, args->tid);
    sem_post(args->sem);
    printf("Numero du compter : %d, tid : %d\n", args->compteur, args->tid);
    free(args);
    return NULL;
}

sem_t* init_sem() {
    sem_t* semaphore = malloc(sizeof(sem_t));
    sem_init(semaphore, 0, 1);
    return semaphore;
}

void detruire_sem(sem_t* sem) {
    sem_destroy(sem);
    free(sem);
}

int main() {

    sem_t* semaphore = init_sem();
    pthread_t tids[10];

    for (int i=0; i<10; i++) {
        struct argumentThread* arg = malloc(sizeof(struct argumentThread));
        arg->compteur = i;
        arg->sem = semaphore;
        pthread_create(&tids[i], NULL, wrapper, (void*)arg);
    }

    for (int i=0; i<10; i++) {
        pthread_join(tids[i], NULL);
    }

    detruire_sem(semaphore);

    return 0 ;
}