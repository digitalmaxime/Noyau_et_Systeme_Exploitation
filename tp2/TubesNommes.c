#include <string.h>
#include <stdlib.h>
#include <unistd.h>
#include <stdio.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <sys/wait.h>
#include <fcntl.h>



int main() {
    char* pathA = "/tmp/pipe_a";
    char* pathB = "/tmp/pipe_b";
    char* jetonA = "284ee28e02b85b6e";
    char* jetonB = "af3e8769a9e6fc37";

    pid_t pidParent = getpid();

    mkfifo(pathA, 0660);
    mkfifo(pathB, 0660);
    //fancyLs devra écrire dans le tube /tmp/pipe a. l’inverse, ticTacToe devra écrire dans
    //le tube /tmp/pipe b.
    if (fork() == 0){
        char buffer [50];
        sprintf(buffer, "%d", pidParent);
        //open(pathA,O_WRONLY);
        execl("./executables/Question1/fancyLs", "fancyLs", buffer,NULL);
        perror("probleme fancy:");
    }

    if (fork() == 0){
        char buffer [50];
        sprintf(buffer, "%d", pidParent);
        //open(pathB,O_WRONLY);
        execl("./executables/Question1/ticTacToe", "ticTacToe", buffer,NULL);
        perror("probleme tictactoe:");
    }

    if (fork() == 0){
        int fdWA = open(pathA,O_WRONLY);
        write(fdWA, jetonA, strlen(jetonA));
        close(fdWA);
        exit(0);
    }

    if (fork() == 0){
        int fdWB = open(pathB,O_WRONLY);
        write(fdWB, jetonB, strlen(jetonB));
        close(fdWB);
        exit(0);
    }

    while(wait(NULL)>0);

}